<!-- Game -->

<!-- Interface -->

<div class="canvas">
    <canvas #mycanvas id="myCanvas"></canvas>
    
    <app-progressbar class="progressBar" [solvedTasks]="taskService.solvedTasks"></app-progressbar>

    <a class="backbtn" (click)="toggleNavigationBack()" title="Navigate back"> 
        <img src="../assets/interface/backArrow-icon.png" alt="Back Icon"> <p>Back</p> </a>
    <a class="infoIbtn" (click)="toggleInfoObjectives()" title="Game objectives"> 
        <img src="../assets/interface/information-icon.png" alt="Info Icon"> <p>Objectives</p></a>
    <a class="infoQbtn" (click)="toggleInfoControls()" title="Game controls"> 
        <img src="../assets/interface/question-icon.png" alt="Info Icon"><p>Controls</p> </a>
    <a class="tipsbtn" (click)="toggleTips()" title="Game tips"> 
        <img src="../assets/interface/question-icon.png" alt="Tips Icon"><p>Tips</p> </a>
    <a class="taskListbtn" (click)="toggleTaskList()" title="Task list"> 
        <img src="../assets/interface/taskList-icon.png" alt="Task Icon"><p>Task list</p> </a>
    <a class="mapbtn" (click)="toggleMap()" title="Map"> 
        <img src="../assets/interface/map-icon.png" alt="Map Icon"><p>Map</p> </a>
    <a class="noteBookbtn" (click)="toggleNoteBook()" title="Notebook">
        <img src="../assets/interface/taskList-icon.png" alt="Notebook Icon"><p>Notebook</p> </a> 
        
    <div class="timer" [ngClass]="{'out-of-time': outOfTime}" title="Big bomb Æææ!">
        &#x23F1; {{ remainingTime | convertMsToHhmmss }}
    </div>

    <a class="musicbtn" (click)="toggleBackgroundMusic()" title="Background music"> 
        <img *ngIf="!isBackgroundMusicMuted" src="../assets/interface/music-icon.png" alt="Music On Icon">
        <img *ngIf="isBackgroundMusicMuted" src="../assets/interface/disabled-music-icon.png" alt="Music Off Icon">
        <p>Music</p>
    </a>
    
    <a class="soundbtn" (click)="muteSounds()" title="Sound effects"> 
        <img *ngIf="!isSoundsMuted" src="../assets/interface/sound-icon.png" alt="Sound On Icon">
        <img *ngIf="isSoundsMuted" src="../assets/interface/disabled-sound-icon.png" alt="Sound Off Icon">
        <p>Sound</p>
    </a>
</div>

<!-- Popups -->

<ng-container *ngIf="backNavigation">
    <div class="choice-popup">
        <div class="popup-content">
          <h2>Are you sure you want to leave this level and go back to the lobby?</h2>
          <p>You will lose all progress if you proceed to the lobby.</p>
          <button class="btn accent" (click)="toggleNavigationBack()"><span>No, stay</span></button>
          <button class="btn primary"(click)="navigateToHome()" (mousedown)="buttonClickSound()"><span>Yes, leave</span></button>
        </div>
    </div>
</ng-container>

<ng-container *ngIf="infoObjectives">
    <div class="modal-popup I" [ngStyle]="{'opacity': opacityToggler ? '0.3' : '1'}">
        <button class="modalClose" (click)="closeModal()">[ x ]</button>
        <div class="info-content"> 
            <p> <strong> <em> <u> Game Objectives </u> </em> </strong>
                <br><br> Our world is filled with many difficult challenges that we have to face. With your help, we can shape the future. It's up to you to embark on a heroic mission to save humanity. <strong><u>Find the mission</u></strong> of this level and solve its task before the <strong><u>time</u></strong> runs out to save the world.
                <br><br> Explore the campus and uncover <strong><u>hidden clues</u></strong> to unravel the mystery behind the impending disaster. During your journey, you will encounter multiple obstacles and challenges. You will have to solve many fun and cozy tasks to be able to progress.
                <br><br> Defeat any problems with your amazing skills in analysis and calculation. Use the legendary items, pen and paper, to <strong><u>take notes</u></strong> and log this exciting adventure.
                <br><br> Navigate this wonderful game design with the help of the <strong><u>map</u></strong> and <strong><u>task list</u></strong>.
                <br><br> It might be a good idea to take a look at the <strong><u>controls</u></strong> before you start.
                <br><br> May the odds be in your favour!
                <br><br> Best regards,
                <br> <em> Jimmy the cool guy </em> </p>
        </div> 
    </div>
</ng-container>

<ng-container *ngIf="infoControls">
    <div class="modal-popup Q" [ngStyle]="{'opacity': opacityToggler ? '0.3' : '1'}">
        <button class="modalClose" (click)="closeModal()">[ x ]</button>
        <div class="info-content"> 
            <p> <strong> <em> <u> Game Controls </u> </em> </strong>
                <br><br> As an aspiring engineering student, you must have full control of the controls to navigate through the challenges and save the day. Here are the controls you need to know:
                <br><br> Use '<strong><u>w</u></strong>' '<strong><u>a</u></strong>' '<strong><u>s</u></strong>' '<strong><u>d</u></strong>' or the <strong><u>arrow keys</u></strong> to move around the campus and explore different areas. <br/> Use '<strong><u>t</u></strong>' '<strong><u>m</u></strong>' '<strong><u>n</u></strong>' to access the tasklist, map and notebook.
                <br><br> Use the <strong><u>spacebar</u></strong> to interact with objects and gather important information. Pay attention to every <strong><u>detail</u></strong>, as it might hold the key to accomplishing the mission.
                <br><br> Sharpen your analytical skills and use the <strong><u>enter key</u></strong> to submit your answers to the tasks. In times of danger you might want to use the <strong><u>escape key</u></strong> to escape the tasks. Show off your problem-solving abilities and prove your engineering prowess.
                <br><br> Now that you know the controls, it's time to onset this thrilling adventure. 
                <br><br> Best of luck, and may your engineering skills shine bright!
                <br><br> Engineering regards,
                <br> <em> Jimmy the dopest of all</em> </p>
        </div> 
    </div>
</ng-container>

<ng-container *ngIf="infoTips">
    <div class="modal-popup tips" [ngStyle]="{'opacity': opacityToggler ? '0.3' : '1'}">
        <button class="modalClose" (click)="closeModal()">[ x ]</button>
        <div class="info-content"> 
            <p> <strong> <em> <u> Game Tips </u> </em> </strong>
                <br><br> Before you start, make sure to carefully review the game objectives and controls. It's important to understand everything before embarking on your mission to save humanity!
                <br><br> Find the mission description and explore the tools at your disposal. After solving a task, you can always review your submission. As an elegant and clever adventurer, you always take notes of your findings, which can be found in the notebook!
                <br><br> As you enter each room, be cautious of your surroundings. If you're stuck, try interacting with objects in the room. You might find a clue that will help you solve the task. 
                <br><br> The library contains endless knowledge, so if you ponder upon a vigorous challenge, try finding a book that might help you. Use the task list to find the relevant book for the task and its location!
                <br><br> You only have a limited amount of time so be careful of wrongful task submissions!
                <br><br> GL, HF, GG, EZ! 
                <br><br> Tipsy regards,
                <br> <em> Jimmy the gangster</em> </p>
        </div> 
    </div>
</ng-container>

<ng-container *ngIf="taskListVisible">
    <div class="taskList" [ngStyle]="{'opacity': opacityToggler ? '0.3' : '1'}">   
        <button class="modalClose" (click)="closeModal()">[ x ]</button>
        <div class="taskListContent">
            <p>Tasklist:</p>
            <div class="" *ngFor="let task of this.taskService.currentTask">
                <div class="" *ngFor="let element of [this.taskService.tasks[task]]">
                    <p> &nbsp; ‣ {{task | convertToBlank:"-"}} : {{element.location}} — {{element.theory}} </p>
                </div>    
            </div>
        </div>
    </div>
</ng-container>

<ng-container>
    <div class="map" [ngStyle]="{'display': mapVisible ? 'block' : 'none', 'opacity': opacityToggler ? '0.3' : '1'}">   
        <button class="modalClose" (click)="closeModal()">[ x ]</button>
        <img src="../assets/RByggStations.png" alt="Map">
        <!-- Map: Paper fold effect -->
        <div>
          <span class="folds main">
             <span class="cell main-1"></span>
             <span class="cell main-2"></span>
             <span class="cell main-1"></span>
             <span class="cell main-2"></span>
             <span class="cell main-1"></span>
          </span>
          
          <span class="folds vertical">
             <span class="cell vertical-1"></span>
             <span class="cell vertical-2"></span>
             <span class="cell vertical-3"></span>
             <span class="cell vertical-4"></span>
             <span class="cell vertical-5"></span>
          </span> 
          
          <span class="folds horizontal">
             <span class="cell horizontal-1"></span>
             <span class="cell horizontal-2"></span>
             <span class="cell horizontal-1"></span>
             <span class="cell horizontal-2"></span>
             <span class="cell horizontal-1"></span>
             <span class="cell horizontal-3"></span>
             <span class="cell horizontal-4"></span>
             <span class="cell horizontal-3"></span>
             <span class="cell horizontal-4"></span>
             <span class="cell horizontal-3"></span>
          </span>
        </div>
    </div>
</ng-container>

<ng-container>
    <div class="modal-popup note" [ngStyle]="{'display': noteBookVisible ? 'block' : 'none', 'opacity': opacityToggler ? '0.3' : '1'}">   
        <button class="modalClose" (click)="closeModal()">[ x ]</button>
        <app-notebook class="notes" [solvedTasks]="taskService.solvedTasks"></app-notebook>
    </div>
</ng-container> 

<!-- Task and Theory modals -->

<ng-container *ngIf="modalVisible">
    <div class="taskContainer" [ngClass]="{'show': modalVisible, 'correctAnswer': correctAnswerSubmitted, 'wrongAnswer': wrongAnswerSubmitted}">
      <app-modal [newestTask]="newestTask"></app-modal>
      <button class="modalClose" (click)="closeModal()">[ x ]</button>
      <div *ngIf="newestTask">
        <button class="submit" (click)="submitTask()"><span>Submit</span></button>
      </div>
    </div>
    <div class="wrongAnswerNotification" *ngIf="wrongAnswerSubmitted">
      &#x23F1; - 10 sec
    </div>
  </ng-container>

<!-- Victory -->

<ng-container *ngIf="victory">
    <div class="win-popup">
        <div class="popup-content">
          <h2>Mission Completed!</h2>
          <p>You have solved all tasks and saved the planet. Knowledge for a better world!</p>
          <img src="../assets/thumbsup.gif" alt="congratulations GIF">
          <h3>This is the time you have left. What is the name behind this amazing performance?</h3>
          <input type="text" [(ngModel)]="playerName" maxlength="16" title="Please enter a name between 1 and 16 characters" placeholder="Jimmy the edgy" required> {{clearTime | convertMsToHhmmss}}
          <button class="btn subScore" (click)="submitScore()" (mousedown)="buttonClickSound()" [disabled]="!playerName"><span>Submit score</span></button>
          <button class="btn navBack" (click)="navigateToHome()" (mousedown)="buttonClickSound()"><span>Back to lobby</span></button>
        </div>
      </div>
</ng-container>

<!-- Defeat -->

<ng-container *ngIf="outOfTime && !victory">
  <div class="choice-popup" [style.display]="hideContainer ? 'none' : ''">
    <div class="popup-content">
      <h2>Mission Failed!</h2>
      <p>The planet has collapsed... Do you want to continue and make the best out of it?</p>
      <button class="btn accent" (click)="hideContainer = true" (mousedown)="buttonClickSound()"><span>Yes, continue</span></button>
      <button class="btn primary" (click)="navigateToHome()" (mousedown)="buttonClickSound()"><span>No, escape</span></button>
    </div>
  </div>
</ng-container>

<!-- Defeat Clear -->

<ng-container *ngIf="clearAfterTime">
    <div class="win-popup">
        <div class="popup-content">
          <h2>Good job!</h2>
          <p>Even though the world burned down you still managed to salvage some of it! Try again and save an another planet!</p>
          <img src="../assets/thumbsup.gif" alt="congratulations GIF">
        </div>
      </div>
</ng-container>
